Мой вариант отличается от предложенного, только тем, что я использовал чистые функции, а изменение состояния и сайд эффекты остались только в главной функции.
Этот подход лучше спагетти-кода, но всё же он далек от идеала и даже от кода, который я привел в первом задании.